apiVersion: skaffold/v2beta2
kind: Config
build:
  artifacts:
  - image: marketsummary
    context: .
deploy:
  helm:
    releases:
      - name: marketsummary
        wait: true
        chartPath: ./charts/marketsummary
        values:
          image: marketsummary
        setValueTemplates:
          istioDomain: "{{.ISTIO_DOMAIN}}"
          productName: "{{.PRODUCT_NAME}}"
          nodeEnv: "{{.NODE_ENV}}"
profiles:
  - name: local
    activation:
      - kubeContext: docker-desktop
    patches:
      - op: add
        path: /deploy/helm/releases/-
        value:
          name: mongodb
          wait: true
          chartPath: bitnami/mongodb
          remote: true
          namespace: springtrader-marketsummary-db